<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Furniture Posts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-color: #2c2c2c; --accent-color: #e8c284; --light-color: #f9f9f9;
            --text-color: #333; --border-color: #eaeaea; --success-color: #28a745;
            --error-color: #dc3545; --warning-color: #ffc107;
        }
        body { font-family: 'Inter', sans-serif; background-color: #f5f5f5; color: var(--text-color); padding: 20px; min-height: 100vh; display: flex; align-items: center; justify-content: center; }
        .login-container { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: 100%; max-width: 400px; text-align: center; }
        .login-container h2 { margin-bottom: 30px; color: var(--primary-color); font-weight: 600; }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-control { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 5px; font-size: 16px; font-family: inherit; transition: border-color 0.3s; }
        .btn { padding: 12px 30px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s; }
        .btn:hover { background: var(--accent-color); color: var(--primary-color); }
        .message.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; display: block; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .admin-container { display: none; width: 100%; max-width: 1200px; background: white; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: var(--primary-color); color: white; padding: 30px; text-align: center; position: relative; }
        .nav-tabs { display: flex; background: #f8f9fa; border-bottom: 1px solid var(--border-color); }
        .tab { padding: 15px 30px; cursor: pointer; border-bottom: 3px solid transparent; font-weight: 500; }
        .tab.active { border-bottom-color: var(--accent-color); color: var(--accent-color); background: white; }
        .tab-content { padding: 30px; display: none; }
        .tab-content.active { display: block; }
        textarea.form-control { resize: vertical; min-height: 100px; }
        .product-card { border: 1px solid var(--border-color); border-radius: 8px; overflow: hidden; background: white; margin-bottom: 15px; }
        .product-info { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .product-actions button { padding: 8px 12px; border-radius: 5px; font-size: 14px; cursor: pointer; margin-left: 5px; }
        .btn-edit { background: var(--warning-color); color: var(--primary-color); }
        .btn-delete { background: var(--error-color); color: white; }
        .order-card { border: 1px solid #d4edda; background: #f0fff4; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .logout-btn { position: absolute; top: 20px; right: 20px; background: var(--error-color); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; }
        @media (max-width: 768px) { .nav-tabs { flex-direction: column; } .logout-btn { position: relative; top: 0; right: 0; margin-top: 15px; } }
    </style>
</head>
<body>
    <div id="login-screen" class="login-container">
        <h2>Admin Login</h2>
        <form id="login-form">
            <div class="form-group">
                <label>Email Address</label>
                <input type="email" id="admin-email" value="mohsinilyas991@gmail.com" class="form-control" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="admin-password" value="mohsinowner870" class="form-control" required>
            </div>
            <div id="login-message" class="message error" style="display: none;">Invalid email or password.</div>
            <button type="submit" id="login-btn" class="btn" style="width: 100%;">Login</button>
        </form>
    </div>

    <div id="admin-dashboard" class="admin-container">
        <div class="header">
            <h1>Furniture Posts Admin</h1>
            <p id="admin-uid-display">UID: Loading...</p>
            <button class="logout-btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>

        <div class="nav-tabs" id="nav-tabs">
            <div class="tab active" data-tab="products">Manage Posts</div>
            <div class="tab" data-tab="orders">View Orders</div>
        </div>

        <div id="tab-content">
            <div id="products-tab" class="tab-content active">
                <div id="product-form-container" style="margin-bottom: 30px;"></div>
                <div id="product-list-container"></div>
            </div>

            <div id="orders-tab" class="tab-content">
                <h2>Customer Orders</h2>
                <div id="orders-list"></div>
            </div>
        </div>
    </div>
    <div id="dashboard-message-container"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, onValue, off, set, push, remove, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        
        // --- Configuration ---
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyDs1ezmQdVAR2XGwPGpnNiQHf8cAVeA49A",
            authDomain: "furniture-articles.firebaseapp.com",
            databaseURL: "https://furniture-articles-default-rtdb.firebaseio.com",
            projectId: "furniture-articles",
            storageBucket: "furniture-articles.firebasestorage.app",
            messagingSenderId: "448976395282",
            appId: "1:448976395282:web:5b517ce0912005248a0ccb",
            measurementId: "G-32KJCP2Y36"
        };
        const ADMIN_EMAIL = 'mohsinilyas991@gmail.com';
        const ADMIN_PASSWORD = 'mohsinowner870';
        
        // --- Initialization ---
        const app = initializeApp(FIREBASE_CONFIG);
        const auth = getAuth(app);
        const rtdb = getDatabase(app);

        let adminUID = null;
        let productsCache = [];

        // --- RTDB References ---
        const getProductsRef = () => ref(rtdb, 'products');
        const getOrdersRef = (uid) => ref(rtdb, `orders/${uid}`);

        // --- DOM Elements ---
        const loginScreen = document.getElementById('login-screen');
        const adminDashboard = document.getElementById('admin-dashboard');
        const loginForm = document.getElementById('login-form');
        const loginMessage = document.getElementById('login-message');
        const logoutBtn = document.getElementById('logout-btn');
        const navTabs = document.getElementById('nav-tabs');
        
        // --- Utility Functions ---

        function showMessage(msg, type = 'success') {
            const container = document.getElementById('dashboard-message-container') || document.body;
            const msgEl = document.createElement('div');
            msgEl.className = `fixed top-4 right-4 p-4 rounded-lg shadow-xl text-white z-50 transition-opacity duration-300 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
            msgEl.textContent = msg;
            container.appendChild(msgEl);
            setTimeout(() => { msgEl.style.opacity = '0'; setTimeout(() => msgEl.remove(), 300); }, 3000);
        }

        // --- Render Functions (Product Form/List) ---

        function renderProductForm(product = null) {
            const container = document.getElementById('product-form-container');
            if (!container) return;
            
            container.innerHTML = `
                <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 15px;">${product ? 'Edit Post' : 'Add New Post'}</h3>
                <form id="product-form" data-product-id="${product ? product.id : ''}" style="border: 1px solid var(--border-color); padding: 20px; border-radius: 8px;">
                    <input type="hidden" name="id" value="${product ? product.id : ''}">
                    <div class="form-group"><label>Post Title</label><input type="text" name="name" value="${product ? product.name : ''}" required class="form-control"></div>
                    <div class="form-group"><label>Description</label><textarea name="description" required class="form-control">${product ? product.description : ''}</textarea></div>
                    <div class="form-group"><label>Price ($)</label><input type="number" name="price" step="0.01" value="${product ? product.price : ''}" required class="form-control"></div>
                    <div class="form-group"><label>Image URL</label><input type="url" name="image" value="${product ? product.image : ''}" required class="form-control" placeholder="Paste image URL"></div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn" style="flex: 1;">
                            <i class="fas fa-save"></i> ${product ? 'Update' : 'Add'}
                        </button>
                        ${product ? `<button type="button" onclick="renderProductForm(null)" class="btn" style="background: var(--error-color); color: white;"><i class="fas fa-times"></i> Cancel</button>` : ''}
                    </div>
                </form>
            `;
            document.getElementById('product-form').addEventListener('submit', handleProductSubmit);
        }

        function renderProductList() {
            const container = document.getElementById('product-list-container');
            if (!container) return;

            container.innerHTML = `
                <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 15px;">Available Posts (${productsCache.length})</h3>
                <div id="product-list-items">
                    ${productsCache.length === 0 ? '<p style="text-align: center; color: #999;">No posts added yet.</p>' : productsCache.map(p => `
                        <div class="product-card">
                            <div class="product-info">
                                <div style="display: flex; align-items: center;">
                                    <img src="${p.image}" alt="${p.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px; margin-right: 15px;" onerror="this.src='https://placehold.co/50x50?text=N/A'" />
                                    <div>
                                        <p style="font-weight: 600;">${p.name}</p>
                                        <p style="color: #666; font-size: 14px;">$${(p.price || 0).toFixed(2)}</p>
                                    </div>
                                </div>
                                <div class="product-actions">
                                    <button data-action="edit" data-id="${p.id}" class="btn-edit"><i class="fas fa-edit"></i> Edit</button>
                                    <button data-action="delete" data-id="${p.id}" class="btn-delete"><i class="fas fa-trash"></i> Delete</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('product-list-items').addEventListener('click', handleProductActions);
        }

        function renderOrdersList(orders) {
            const container = document.getElementById('orders-list');
            if (!container) return;

            container.innerHTML = `
                <p style="margin-bottom: 20px; color: #666;">Total Orders: ${orders.length}</p>
                <div style="max-height: 500px; overflow-y: auto; padding-right: 10px;">
                    ${orders.length === 0 ? '<p style="text-align: center; color: #999;">No orders found.</p>' : orders.map(order => `
                        <div class="order-card" style="border-left: 4px solid var(--success-color);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <p style="font-weight: 600;">Order ID: ${order.id.substring(0, 8)}...}</p>
                                <button data-id="${order.id}" data-action="delete-order" class="btn-delete" style="padding: 5px 10px;"><i class="fas fa-trash"></i></button>
                            </div>
                            <p style="font-weight: 700; color: var(--primary-color);">Total: $${order.total.toFixed(2)}</p>
                            <p style="font-size: 12px; color: #666;">Date: ${new Date(order.createdAt).toLocaleDateString()}</p>
                            <ul style="list-style: disc; margin-left: 20px; font-size: 14px; margin-top: 5px;">
                                ${order.items.map(item => `<li>${item.name} x ${item.qty}</li>`).join('')}
                            </ul>
                        </div>
                    `).join('')}
                </div>
            `;
            container.addEventListener('click', handleOrderActions);
        }

        // --- RTDB Management Logic ---

        async function handleProductSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const id = form.getAttribute('data-product-id');
            const data = {
                name: form.name.value, description: form.description.value,
                price: parseFloat(form.price.value), image: form.image.value,
                adminId: adminUID
            };

            try {
                if (id) {
                    const productRef = ref(rtdb, `products/${id}`);
                    await update(productRef, {...data, updatedAt: Date.now()});
                    showMessage('Post updated successfully!');
                } else {
                    const newProductRef = push(getProductsRef());
                    await set(newProductRef, {...data, createdAt: Date.now(), id: newProductRef.key});
                    showMessage('New post added successfully!');
                    form.reset();
                }
                renderProductForm(null); // Reset form after action
            } catch (error) {
                console.error("Product save error:", error);
                showMessage('Failed to save post. (Check RTDB Rules)', 'error');
            }
        }

        async function handleProductActions(e) {
            const target = e.target.closest('button');
            if (!target) return;

            const action = target.getAttribute('data-action');
            const id = target.getAttribute('data-id');

            if (action === 'edit') {
                const productToEdit = productsCache.find(p => p.id === id);
                if (productToEdit) {
                    renderProductForm(productToEdit);
                }
            } else if (action === 'delete') {
                if (confirm('Are you sure you want to delete this post?')) {
                    try {
                        const productRef = ref(rtdb, `products/${id}`);
                        await remove(productRef);
                        showMessage('Post deleted successfully!');
                    } catch (error) {
                        console.error("Deletion error:", error);
                        showMessage('Failed to delete post.', 'error');
                    }
                }
            }
        }

        function setupProductListener() {
            const productsRef = getProductsRef();
            onValue(productsRef, (snapshot) => {
                const productsObject = snapshot.val();
                productsCache = productsObject 
                    ? Object.keys(productsObject).map(key => ({ id: key, ...productsObject[key] })).sort((a, b) => b.createdAt - a.createdAt) 
                    : [];
                renderProductList();
            }, (error) => {
                console.error("Product Listener Error:", error);
            });
        }

        function loadOrders() {
            const ordersRef = getOrdersRef(adminUID);
            const container = document.getElementById('orders-list');
            if (!container) return;

            container.innerHTML = '<p style="text-align: center;">Loading orders...</p>';

            onValue(ordersRef, (snapshot) => {
                const ordersObject = snapshot.val();
                const ordersArray = ordersObject 
                    ? Object.keys(ordersObject).map(key => ({ id: key, ...ordersObject[key] })).sort((a, b) => b.createdAt - a.createdAt) 
                    : [];
                
                renderOrdersList(ordersArray);
            }, { onlyOnce: true });
        }

        async function handleOrderActions(e) {
            const target = e.target.closest('button[data-action="delete-order"]');
            if (!target) return;

            const id = target.getAttribute('data-id');

            if (confirm('Are you sure you want to delete this order?')) {
                try {
                    const orderRef = ref(rtdb, `orders/${adminUID}/${id}`);
                    await remove(orderRef);
                    showMessage('Order deleted successfully!');
                    loadOrders(); 
                } catch (error) {
                    console.error("Order deletion error:", error);
                    showMessage('Failed to delete order.', 'error');
                }
            }
        }

        // --- Auth & Initialization ---

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            loginMessage.style.display = 'none';
            document.getElementById('login-btn').textContent = 'Logging in...';

            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                loginMessage.textContent = 'Invalid email or password.';
                loginMessage.style.display = 'block';
            } finally {
                document.getElementById('login-btn').textContent = 'Login';
            }
        });

        logoutBtn.addEventListener('click', async () => {
            await signOut(auth);
        });

        onAuthStateChanged(auth, (user) => {
            if (user && user.email === ADMIN_EMAIL) {
                adminUID = user.uid;
                loginScreen.style.display = 'none';
                adminDashboard.style.display = 'block';
                document.getElementById('admin-uid-display').textContent = `UID: ${adminUID.substring(0, 10)}...`;
                renderProductForm(null);
                setupProductListener();
                showMessage(`Welcome, Admin!`, 'success');

            } else {
                adminUID = null;
                adminDashboard.style.display = 'none';
                loginScreen.style.display = 'block';
            }
        });

        navTabs.addEventListener('click', (e) => {
            if (e.target.classList.contains('tab')) {
                const tabId = e.target.getAttribute('data-tab');
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(`${tabId}-tab`).classList.add('active');

                if (tabId === 'orders') {
                    loadOrders();
                }
            }
        });
    </script>
</body>
</html>
```eof

---

## 2. Public User Panel Code (`index.html`)

```html:E-commerce User Panel:index.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Furniture Articles</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-color: #2c2c2c; --accent-color: #e8c284; --light-color: #f9f9f9;
            --text-color: #333; --border-color: #eaeaea; --sale-color: #e65540;
        }
        body { font-family: 'Inter', sans-serif; color: var(--text-color); background-color: #fff; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        header { background-color: #fff; position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border-color); }
        .header-top { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; }
        .logo { font-size: 24px; font-weight: 700; letter-spacing: 1px; color: var(--primary-color); }
        .nav-links { display: flex; list-style: none; }
        .nav-links li { margin: 0 15px; }
        .nav-links a { text-decoration: none; color: var(--text-color); font-weight: 500; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; transition: color 0.3s; }
        .nav-links a:hover { color: var(--accent-color); }
        .hero-slider { position: relative; height: 80vh; overflow: hidden; margin-bottom: 80px; }
        .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; transition: opacity 1s ease-in-out; }
        .slide.active { opacity: 1; }
        .slide-content { position: absolute; top: 50%; left: 10%; transform: translateY(-50%); max-width: 500px; color: white; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
        .slide-content h1 { font-size: 48px; margin-bottom: 20px; font-weight: 300; line-height: 1.2; }
        .btn { display: inline-block; padding: 14px 32px; background-color: var(--primary-color); color: white; text-decoration: none; font-weight: 600; letter-spacing: 1px; transition: all 0.3s; border: none; cursor: pointer; text-transform: uppercase; font-size: 14px; }
        .btn:hover { background-color: var(--accent-color); color: var(--primary-color); }
        .products-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; margin-bottom: 80px; }
        .product-card { position: relative; transition: transform 0.3s, box-shadow 0.3s; background: white; border-radius: 8px; overflow: hidden; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .product-image { height: 250px; background-color: #f5f5f5; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        .product-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
        .product-info { padding: 20px; text-align: center; }
        .product-title { font-size: 16px; margin-bottom: 8px; font-weight: 500; }
        .cart-count { background-color: #ef4444; color: white; font-size: 0.75rem; line-height: 1rem; border-radius: 9999px; height: 1.25rem; width: 1.25rem; display: flex; items-align: center; justify-content: center; transform: translate(25%, -25%); position: absolute; top: 0; right: 0;}
        .section-title { text-align: center; margin-bottom: 50px; font-size: 32px; font-weight: 300; position: relative; padding-bottom: 15px; }
        .cart-item { display: flex; align-items: center; background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .quantity-control button { background: #f0f0f0; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }

        @media (max-width: 1200px) { .products-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 768px) { .products-grid { grid-template-columns: 1fr 1fr; } .slide-content h1 { font-size: 36px; } }
        @media (max-width: 576px) { .products-grid { grid-template-columns: 1fr; } .header-top { flex-wrap: wrap; justify-content: center; } .logo, .cart-nav { margin-bottom: 10px; } }
    </style>
</head>
<body>
    <div id="content-area">
        </div>
    <div id="message-container"></div>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, onValue, off, set, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // --- Configuration ---
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyDs1ezmQdVAR2XGwPGpnNiQHf8cAVeA49A",
            authDomain: "furniture-articles.firebaseapp.com",
            databaseURL: "https://furniture-articles-default-rtdb.firebaseio.com",
            projectId: "furniture-articles",
            storageBucket: "furniture-articles.firebasestorage.app",
            messagingSenderId: "448976395282",
            appId: "1:448976395282:web:5b517ce0912005248a0ccb",
            measurementId: "G-32KJCP2Y36"
        };
        const TARGET_ADMIN_EMAIL = 'mohsinilyas991@gmail.com'; 
        const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdYdJ23hSvXjNBgqnjnxLdQl2ACXA5blZX-a84ZuRCoDuoBuA/viewform";

        // --- Initialization ---
        const app = initializeApp(FIREBASE_CONFIG);
        const auth = getAuth(app);
        const rtdb = getDatabase(app);

        let productsCache = [];
        let cart = [];
        let adminUIDCache = null;

        // --- RTDB References ---
        const getProductsRef = () => ref(rtdb, 'products');
        const getOrdersRef = (uid) => ref(rtdb, `orders/${uid}`);

        // --- Utility Functions ---
        
        function getPublicUID() { return auth.currentUser ? auth.currentUser.uid : 'anonymous_guest'; }
        
        function showMessage(msg, type = 'success') {
            const container = document.getElementById('message-container');
            const msgEl = document.createElement('div');
            msgEl.className = `fixed top-4 right-4 p-4 rounded-lg shadow-xl text-white z-50 transition-opacity duration-300 ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
            msgEl.textContent = msg;
            container.appendChild(msgEl);
            setTimeout(() => { msgEl.style.opacity = '0'; setTimeout(() => msgEl.remove(), 300); }, 3000);
        }

        function saveCart() { localStorage.setItem('shoppingCart', JSON.stringify(cart)); renderPublicSite(); }
        function loadCart() { const savedCart = localStorage.getItem('shoppingCart'); if (savedCart) { cart = JSON.parse(savedCart); } }

        // --- Cart Management Logic ---

        function addToCart(productId) {
            const product = productsCache.find(p => p.id === productId);
            if (!product) return;

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                cart = cart.map(item => item.id === productId ? { ...item, qty: item.qty + 1 } : item);
            } else {
                cart.push({ ...product, qty: 1 });
            }
            showMessage(`${product.name} added to cart!`, 'success');
            saveCart();
        }

        function updateQuantity(productId, delta) {
            cart = cart.map(item => item.id === productId ? { ...item, qty: item.qty + delta } : item).filter(item => item.qty > 0);
            saveCart();
        }

        function removeItem(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
        }

        function getCartTotal() { return cart.reduce((sum, item) => sum + item.price * item.qty, 0); }

        // --- Checkout Handler ---

        async function handleCheckout() {
            if (cart.length === 0) {
                showMessage('Your cart is empty!', 'error');
                return;
            }
            
            if (!adminUIDCache) {
                showMessage('Error: Admin must add at least one product first. Order cannot be saved.', 'error');
                return;
            }

            const orderDetails = {
                customerId: getPublicUID(),
                items: cart.map(item => ({ id: item.id, name: item.name, price: item.price, qty: item.qty })),
                total: getCartTotal(),
                createdAt: Date.now(),
                status: 'Pending Form Submission',
            };

            try {
                const adminOrdersRef = getOrdersRef(adminUIDCache);
                const newOrderRef = push(adminOrdersRef);

                await set(newOrderRef, { ...orderDetails, id: newOrderRef.key });

                cart = [];
                saveCart();
                showMessage('Order created! Redirecting to form...', 'success');
                
                setTimeout(() => { window.open(GOOGLE_FORM_URL, '_blank'); }, 1000);

            } catch (error) {
                console.error("Error processing order:", error);
                showMessage('Failed to process order. (RTDB Rules or Connection Error)', 'error');
            }
        }
        
        // --- RTDB Listeners ---
        
        function setupProductListener() {
            const productsRef = getProductsRef();
            onValue(productsRef, (snapshot) => {
                const productsObject = snapshot.val();
                productsCache = productsObject 
                    ? Object.keys(productsObject).map(key => ({ id: key, ...productsObject[key] })).sort((a, b) => b.createdAt - a.createdAt) 
                    : [];
                
                // Get Admin UID from the first product posted
                if (productsCache.length > 0 && productsCache[0].adminId && !adminUIDCache) {
                    adminUIDCache = productsCache[0].adminId;
                }

                renderPublicSite();
            }, (error) => {
                console.error("Public Product Listener Error:", error);
            });
        }
        
        // --- Rendering Logic ---

        function renderHeader(currentView) {
            const cartCount = cart.reduce((sum, item) => sum + item.qty, 0);
            return `
                <header>
                    <div class="container">
                        <div class="header-top">
                            <div class="logo">Furniture Articles</div>
                            <ul class="nav-links">
                                <li><a href="#" onclick="changeView('shop')">Shop</a></li>
                                <li><a href="admin.html">Admin Login</a></li>
                            </ul>
                            <div class="cart-nav" style="position: relative;">
                                <button onclick="changeView('cart')" style="background: none; border: none; cursor: pointer; color: var(--primary-color);">
                                    <i class="fas fa-shopping-cart" style="font-size: 24px;"></i>
                                    ${cartCount > 0 ? `<span class="cart-count">${cartCount}</span>` : ''}
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
            `;
        }
        
        function renderSlider() {
            return `
                <section class="hero-slider">
                    <div class="slide active" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1551216128-40b9000a68d4?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');">
                        <div class="slide-content">
                            <h1>Exclusive Furniture Collection</h1>
                            <p>Discover elegant and comfortable pieces for your home</p>
                            <a href="#products-section" class="btn">Explore Now</a>
                        </div>
                    </div>
                    <div class="slide" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1544983058-294b2a8d1162?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');">
                        <div class="slide-content">
                            <h1>Modern Design Solutions</h1>
                            <p>Transform your space with contemporary furniture designs</p>
                            <a href="#products-section" class="btn">Shop Now</a>
                        </div>
                    </div>
                    <div class="slider-dots" style="display: none;"></div>
                </section>
            `;
        }

        function renderShopView() {
             return `
                <div id="shop-content">
                    ${renderSlider()}
                    <section class="container" id="products-section">
                        <h2 class="section-title">Featured Posts</h2>
                        <div class="products-grid">
                            ${productsCache.length === 0 
                                ? '<p style="text-align: center; grid-column: 1/-1;">Products are loading or none are available.</p>' 
                                : productsCache.map(p => `
                                    <div class="product-card">
                                        <div class="product-image">
                                            <img src="${p.image}" alt="${p.name}" onerror="this.src='https://placehold.co/400x300?text=Image+N/A'" />
                                        </div>
                                        <div class="product-info">
                                            <div>
                                                <h3 class="product-title">${p.name}</h3>
                                                <p style="font-weight: 700; color: var(--accent-color); font-size: 18px;">$${(p.price || 0).toFixed(2)}</p>
                                            </div>
                                            <button onclick="addToCart('${p.id}')" class="btn" style="padding: 10px 15px; margin-top: 10px;">
                                                <i class="fas fa-cart-plus"></i> Add to Cart
                                            </button>
                                        </div>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </section>
                </div>
             `;
        }

        function renderCartView() {
            const total = getCartTotal();

            return `
                <div id="cart-content" class="container" style="padding-top: 50px;">
                    <h2 class="section-title">Your Shopping Cart</h2>
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 40px;">
                        <div id="cart-items-list">
                            ${cart.length === 0 ? `
                                <p style="text-align: center; padding: 40px; border: 1px dashed var(--border-color);">Your cart is empty.</p>
                            ` : cart.map(item => `
                                <div class="cart-item">
                                    <img src="${item.image}" alt="${item.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 5px; margin-right: 20px;" onerror="this.src='https://placehold.co/60x60?text=N/A'" />
                                    <div style="flex-grow: 1;">
                                        <h4 style="font-weight: 600;">${item.name}</h4>
                                        <p style="color: #666; font-size: 14px;">$${item.price.toFixed(2)}</p>
                                    </div>
                                    <div class="quantity-control" style="display: flex; align-items: center; margin-right: 20px;">
                                        <button onclick="updateQuantity('${item.id}', -1)">-</button>
                                        <span style="padding: 0 10px;">${item.qty}</span>
                                        <button onclick="updateQuantity('${item.id}', 1)">+</button>
                                    </div>
                                    <button onclick="removeItem('${item.id}')" style="background: none; border: none; color: var(--error-color); cursor: pointer;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>

                        <div style="padding: 20px; background: var(--light-color); border-radius: 8px; align-self: flex-start; position: sticky; top: 100px;">
                            <h3 style="font-size: 24px; font-weight: 600; margin-bottom: 20px;">Order Summary</h3>
                            <div style="display: flex; justify-content: space-between; font-size: 20px; font-weight: 700; color: var(--primary-color); border-top: 1px solid var(--border-color); padding-top: 15px;">
                                <span>Total:</span>
                                <span>$${total.toFixed(2)}</span>
                            </div>
                            <button onclick="handleCheckout()" class="btn" style="background: var(--success-color); width: 100%; margin-top: 20px; padding: 15px;">
                                Checkout (Google Form)
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        let currentView = 'shop';

        function changeView(newView) {
            currentView = newView;
            renderPublicSite();
        }

        function renderPublicSite() {
            const container = document.getElementById('content-area');
            container.innerHTML = '';
            
            container.innerHTML = renderHeader(currentView);
            
            if (currentView === 'shop') {
                container.innerHTML += renderShopView();
            } else if (currentView === 'cart') {
                container.innerHTML += renderCartView();
            }
            
            if (currentView === 'shop') {
                 // Initialize the simple slider after rendering the shop view
                const slides = document.querySelectorAll('.hero-slider .slide');
                let currentSlide = 0;
                if (slides.length > 0) {
                    slides[0].classList.add('active');
                    setInterval(() => {
                        slides[currentSlide].classList.remove('active');
                        currentSlide = (currentSlide + 1) % slides.length;
                        slides[currentSlide].classList.add('active');
                    }, 5000);
                }
            }
        }
        
        // --- Initialization ---

        window.changeView = changeView;
        window.addToCart = addToCart;
        window.updateQuantity = updateQuantity;
        window.removeItem = removeItem;
        window.handleCheckout = handleCheckout;

        document.addEventListener('DOMContentLoaded', () => {
            loadCart();
            
            // Sign in anonymously for customer actions
            signInAnonymously(auth).catch(error => { console.error("Anonymous sign-in failed:", error); });
            
            setupProductListener();
        });
    </script>
</body>
</html>
